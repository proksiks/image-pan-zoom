!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).ImagePanZoom={})}(this,function(t){"use strict";class i{container;content;options;scale;x;y;rotation;isPanning=!1;didMove=!1;startClientX=0;startClientY=0;startX=0;startY=0;velocityX=0;velocityY=0;velocityScale=0;lastMoveTime=0;lastClientX=0;lastClientY=0;lastScale=1;animationFrameId=null;DRAG_THRESHOLD=3;touchStartDistance=0;touchStartScale=1;touchCenterX=0;touchCenterY=0;isPinching=!1;lastTouchCenterX=0;lastTouchCenterY=0;transitionDuration=300;transitionEasing="ease-out";isTransitioning=!1;transitionTimeout=null;lastTouchEndTime=0;lastTouchX=0;lastTouchY=0;DOUBLE_TAP_DELAY=300;DOUBLE_TAP_THRESHOLD=10;boundWheel;boundPointerDown;boundPointerMove;boundPointerUp;boundDoubleClick;boundTouchStart;boundTouchMove;boundTouchEnd;constructor(t,i,n={}){this.container=t,this.content=i,this.options={minScale:n.minScale??.5,maxScale:n.maxScale??3,initialScale:n.initialScale??1,wheelZoomSpeed:n.wheelZoomSpeed??.0015,boundsPadding:n.boundsPadding??.1,friction:n.friction??.92,maxSpeed:n.maxSpeed??300,transition:n.transition??!1,pinchSpeed:n.pinchSpeed??1},this.scale=this.options.initialScale,this.x=0,this.y=0,this.rotation=0,this.lastScale=this.options.initialScale,this.boundWheel=this.onWheel.bind(this),this.boundPointerDown=this.onPointerDown.bind(this),this.boundPointerMove=this.onPointerMove.bind(this),this.boundPointerUp=this.onPointerUp.bind(this),this.boundDoubleClick=this.onDoubleClick.bind(this),this.boundTouchStart=this.onTouchStart.bind(this),this.boundTouchMove=this.onTouchMove.bind(this),this.boundTouchEnd=this.onTouchEnd.bind(this),this.init()}init(){this.content.style.touchAction="none",this.content.style.userSelect="none",this.applyTransform(),this.attachEvents()}attachEvents(){this.container.addEventListener("wheel",this.boundWheel,{passive:!1}),this.content.addEventListener("pointerdown",this.boundPointerDown),this.content.addEventListener("dblclick",this.boundDoubleClick),window.addEventListener("pointermove",this.boundPointerMove),window.addEventListener("pointerup",this.boundPointerUp),this.container.addEventListener("touchstart",this.boundTouchStart,{passive:!1}),this.container.addEventListener("touchmove",this.boundTouchMove,{passive:!1}),this.container.addEventListener("touchend",this.boundTouchEnd,{passive:!1})}getSizes(){const t=this.container.getBoundingClientRect(),i=t.width,n=t.height,s=Math.min(i,n)*this.options.boundsPadding,e=this.content.offsetWidth,o=this.content.offsetHeight;return{contW:i,contH:n,pad:s,w:e*this.scale,h:o*this.scale}}clampPosition(t,i){const{contW:n,contH:s,pad:e,w:o,h:h}=this.getSizes(),a=o<=n,c=h<=s;let l,r,u,d;if(a)l=r=0;else{const t=n/2,i=o/2;r=i-t+e,l=-(i-t)-e}if(c)u=d=0;else{const t=s/2,i=h/2;d=i-t+e,u=-(i-t)-e}return{x:a?0:Math.min(r,Math.max(l,t)),y:c?0:Math.min(d,Math.max(u,i))}}applyTransform(t=!1){this.container.style.overflow="hidden",this.container.style.position||(this.container.style.position="relative"),this.container.style.minHeight="25vh",this.content.style.position="absolute",this.content.style.top="50%",this.content.style.left="50%",this.content.style.transformOrigin="50% 50%";const i=this.clampPosition(this.x,this.y);this.x=i.x,this.y=i.y,this.options.transition&&t&&!this.isTransitioning?(this.content.style.transition=`transform ${this.transitionDuration}ms ${this.transitionEasing}`,this.isTransitioning=!0,this.transitionTimeout&&clearTimeout(this.transitionTimeout),this.transitionTimeout=window.setTimeout(()=>{this.content.style.transition="",this.isTransitioning=!1,this.transitionTimeout=null},this.transitionDuration)):t||(this.content.style.transition="none",this.isTransitioning=!1),this.content.style.transform=`translate(-50%, -50%) translate(${this.x}px, ${this.y}px) rotate(${this.rotation}deg) scale(${this.scale})`}clampScale(t){return Math.min(this.options.maxScale,Math.max(this.options.minScale,t))}stopAnimation(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}zoomToPoint(t,i,n){const s=this.container.getBoundingClientRect(),e=this.scale,o=this.clampScale(e*n);if(o===e)return;const h=t-s.left,a=i-s.top,c=s.width/2,l=s.height/2,r=h-c-this.x,u=a-l-this.y,d=o/e,m=r*d,p=u*d;this.scale=o,this.x+=r-m,this.y+=u-p,this.applyTransform(!1)}moveTo(t,i,n){this.stopAnimation();const s=this.container.getBoundingClientRect(),e=s.width/2,o=s.height/2;this.x=t-e,this.y=i-o;const h=this.clampPosition(this.x,this.y);this.x=h.x,this.y=h.y;const a=void 0===n||n;this.applyTransform(a&&this.options.transition)}moveBy(t,i,n){this.stopAnimation(),this.x+=t,this.y+=i;const s=this.clampPosition(this.x,this.y);this.x=s.x,this.y=s.y;const e=void 0===n||n;this.applyTransform(e&&this.options.transition)}zoomTo(t,i,n,s){this.stopAnimation();const e=this.container.getBoundingClientRect(),o=void 0!==i?i:e.width/2,h=void 0!==n?n:e.height/2,a=this.scale,c=this.clampScale(t);if(c===a)return;const l=e.width/2,r=e.height/2,u=o-l-this.x,d=h-r-this.y,m=c/a,p=u*m,v=d*m;this.scale=c,this.x+=u-p,this.y+=d-v;const y=void 0===s||s;this.applyTransform(y&&this.options.transition)}animateKinetic=()=>{if(Math.abs(this.velocityX)<.5&&Math.abs(this.velocityY)<.5&&Math.abs(this.velocityScale)<.001)return this.stopAnimation(),void this.applyTransform(!1);this.x+=this.velocityX,this.y+=this.velocityY,this.scale+=this.velocityScale,this.scale=this.clampScale(this.scale),this.velocityX*=this.options.friction,this.velocityY*=this.options.friction,this.velocityScale*=this.options.friction,this.applyTransform(!1),this.animationFrameId=requestAnimationFrame(this.animateKinetic)};onWheel(t){t.preventDefault(),this.stopAnimation(),this.velocityX=0,this.velocityY=0,this.velocityScale=0;const i=1+-t.deltaY*this.options.wheelZoomSpeed;0!==i&&this.zoomToPoint(t.clientX,t.clientY,i)}onPointerDown(t){0===t.button&&(this.stopAnimation(),this.isPanning=!0,this.didMove=!1,this.startClientX=t.clientX,this.startClientY=t.clientY,this.startX=this.x,this.startY=this.y,this.lastClientX=t.clientX,this.lastClientY=t.clientY,this.lastScale=this.scale,this.lastMoveTime=Date.now(),this.velocityX=0,this.velocityY=0,this.velocityScale=0,this.content.setPointerCapture(t.pointerId))}onPointerMove(t){if(!this.isPanning)return;const i=t.clientX-this.startClientX,n=t.clientY-this.startClientY;if(!this.didMove&&Math.hypot(i,n)<this.DRAG_THRESHOLD)return;this.didMove=!0;const s=this.startX+i,e=this.startY+n;this.x=s,this.y=e;const o=Date.now(),h=o-this.lastMoveTime;if(h>0){const i=(t.clientX-this.lastClientX)/h*16,n=(t.clientY-this.lastClientY)/h*16,s=(this.scale-this.lastScale)/h*16;this.velocityX=Math.max(-this.options.maxSpeed,Math.min(this.options.maxSpeed,i)),this.velocityY=Math.max(-this.options.maxSpeed,Math.min(this.options.maxSpeed,n)),this.velocityScale=Math.max(-.01,Math.min(.01,s))}this.lastClientX=t.clientX,this.lastClientY=t.clientY,this.lastScale=this.scale,this.lastMoveTime=o,this.applyTransform(!1)}onPointerUp(t){if(this.isPanning){this.isPanning=!1;try{this.content.releasePointerCapture(t.pointerId)}catch{}this.didMove&&(Math.abs(this.velocityX)>1||Math.abs(this.velocityY)>1||Math.abs(this.velocityScale)>.001)&&(this.animationFrameId=requestAnimationFrame(this.animateKinetic))}}onDoubleClick(t){this.stopAnimation();const i=this.container.getBoundingClientRect(),n=i.width/2,s=i.height/2,e=t.clientX-i.left,o=t.clientY-i.top,h=Math.min(1.5*this.scale,this.options.maxScale),a=h/this.scale,c=e-n-this.x,l=o-s-this.y;this.scale=h;const r=c*a,u=l*a;this.x+=c-r,this.y+=l-u,this.applyTransform(!0)}onTouchStart(t){if(2===t.touches.length){t.preventDefault(),this.stopAnimation(),this.isPinching=!0,this.velocityX=0,this.velocityY=0,this.velocityScale=0;const i=t.touches[0],n=t.touches[1],s=Math.hypot(i.clientX-n.clientX,i.clientY-n.clientY);this.touchCenterX=(i.clientX+n.clientX)/2,this.touchCenterY=(i.clientY+n.clientY)/2,this.lastTouchCenterX=this.touchCenterX,this.lastTouchCenterY=this.touchCenterY,this.touchStartDistance=s,this.touchStartScale=this.scale,this.isPanning=!1,this.didMove=!1}else if(1===t.touches.length){const i=t.touches[0],n=new PointerEvent("pointerdown",{clientX:i.clientX,clientY:i.clientY,button:0});this.onPointerDown(n)}}onTouchMove(t){if(2===t.touches.length&&this.isPinching){t.preventDefault();const i=t.touches[0],n=t.touches[1],s=Math.hypot(i.clientX-n.clientX,i.clientY-n.clientY),e=(i.clientX+n.clientX)/2,o=(i.clientY+n.clientY)/2,h=s/this.touchStartDistance,a=this.touchStartScale*h*this.options.pinchSpeed,c=this.clampScale(a);if(c!==this.scale){const t=e-this.lastTouchCenterX,i=o-this.lastTouchCenterY;this.x+=t,this.y+=i;const n=c/this.scale;this.zoomToPoint(this.touchCenterX,this.touchCenterY,n),this.lastTouchCenterX=e,this.lastTouchCenterY=o}}else if(1===t.touches.length&&!this.isPinching){const i=t.touches[0],n=new PointerEvent("pointermove",{clientX:i.clientX,clientY:i.clientY});this.onPointerMove(n)}}onTouchEnd(t){if(this.isPinching&&t.touches.length<2){this.isPinching=!1;const t=Date.now()-this.lastMoveTime;if(t>0&&t<100){const i=(this.lastTouchCenterX-this.touchCenterX)/t*16,n=(this.lastTouchCenterY-this.touchCenterY)/t*16;this.velocityX=Math.max(-this.options.maxSpeed,Math.min(this.options.maxSpeed,i)),this.velocityY=Math.max(-this.options.maxSpeed,Math.min(this.options.maxSpeed,n)),(Math.abs(this.velocityX)>1||Math.abs(this.velocityY)>1)&&(this.animationFrameId=requestAnimationFrame(this.animateKinetic))}}if(0===t.touches.length){if(this.isPanning){const t=new PointerEvent("pointerup",{clientX:0,clientY:0,button:0});this.onPointerUp(t)}this.isPinching=!1,this.handleDoubleTapCheck(t)}}handleDoubleTapCheck(t){const i=Date.now(),n=t.changedTouches[0];if(!n)return;const s=n.clientX,e=n.clientY;i-this.lastTouchEndTime<this.DOUBLE_TAP_DELAY&&Math.abs(s-this.lastTouchX)<this.DOUBLE_TAP_THRESHOLD&&Math.abs(e-this.lastTouchY)<this.DOUBLE_TAP_THRESHOLD?(this.handleDoubleTap(s,e),this.lastTouchEndTime=0,this.lastTouchX=0,this.lastTouchY=0):(this.lastTouchEndTime=i,this.lastTouchX=s,this.lastTouchY=e)}handleDoubleTap(t,i){this.stopAnimation();const n=this.container.getBoundingClientRect(),s=n.width/2,e=n.height/2,o=t-n.left,h=i-n.top,a=Math.min(1.5*this.scale,this.options.maxScale),c=a/this.scale,l=o-s-this.x,r=h-e-this.y;this.scale=a;const u=l*c,d=r*c;this.x+=l-u,this.y+=r-d,this.applyTransform(!0)}reset(){this.stopAnimation(),this.scale=this.options.initialScale,this.x=0,this.y=0,this.rotation=0,this.velocityX=0,this.velocityY=0,this.velocityScale=0,this.applyTransform(!0)}rotate(t){this.rotation=(this.rotation+t)%360,this.applyTransform(!0)}getTransform(){return{scale:this.scale,x:this.x,y:this.y,rotation:this.rotation}}setTransform(t,i){void 0!==t.scale&&(this.scale=this.clampScale(t.scale)),void 0!==t.x&&(this.x=t.x),void 0!==t.y&&(this.y=t.y),void 0!==t.rotation&&(this.rotation=t.rotation);const n=void 0===i||i;this.applyTransform(n&&this.options.transition)}getViewportBounds(){const t=this.container.getBoundingClientRect(),i=t.width/2,n=t.height/2;return{left:i+this.x,top:n+this.y,right:i+this.x,bottom:n+this.y}}containerToImage(t,i){const n=this.container.getBoundingClientRect(),s=this.content.getBoundingClientRect(),e=n.width/2,o=n.height/2,h=t-e-this.x,a=i-o-this.y;return{x:h/this.scale+s.width/2/this.scale,y:a/this.scale+s.height/2/this.scale}}imageToContainer(t,i){const n=this.container.getBoundingClientRect(),s=this.content.getBoundingClientRect(),e=n.width/2,o=n.height/2,h=(t-s.width/2/this.scale)*this.scale,a=(i-s.height/2/this.scale)*this.scale;return{x:e+this.x+h,y:o+this.y+a}}centerOnImagePoint(t,i,n){const s=this.imageToContainer(t,i);this.moveTo(s.x,s.y,n)}destroy(){this.stopAnimation(),this.transitionTimeout&&(clearTimeout(this.transitionTimeout),this.transitionTimeout=null),this.container.removeEventListener("wheel",this.boundWheel),this.content.removeEventListener("pointerdown",this.boundPointerDown),this.content.removeEventListener("dblclick",this.boundDoubleClick),window.removeEventListener("pointermove",this.boundPointerMove),window.removeEventListener("pointerup",this.boundPointerUp),this.container.removeEventListener("touchstart",this.boundTouchStart),this.container.removeEventListener("touchmove",this.boundTouchMove),this.container.removeEventListener("touchend",this.boundTouchEnd),this.content.style.transform="",this.content.style.touchAction=""}}t.ImagePanZoom=i,t.createImagePanZoom=function(t,n,s){return new i(t,n,s)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=image-pan-zoom.umd.js.map
