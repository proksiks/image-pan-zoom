{"version":3,"file":"image-pan-zoom.mjs","sources":["../src/index.ts"],"sourcesContent":["/**\r\n * ImagePanZoom - A lightweight library for pan and zoom functionality\r\n * @version 1.0.0\r\n */\r\n\r\n/**\r\n * Options for configuring the ImagePanZoom behavior\r\n */\r\nexport interface ImagePanZoomOptions {\r\n  /**\r\n   * Minimum scale value (default: 0.5)\r\n   */\r\n  minScale?: number\r\n  /**\r\n   * Maximum scale value (default: 3)\r\n   */\r\n  maxScale?: number\r\n  /**\r\n   * Initial scale value (default: 1)\r\n   */\r\n  initialScale?: number\r\n  /**\r\n   * Speed of zoom via mouse wheel (default: 0.0015)\r\n   */\r\n  wheelZoomSpeed?: number\r\n  /**\r\n   * Padding for boundaries in percentage (default: 0.1)\r\n   */\r\n  boundsPadding?: number\r\n  /**\r\n   * Friction coefficient for kinetic motion (default: 0.92)\r\n   */\r\n  friction?: number\r\n  /**\r\n   * Maximum speed for kinetic motion (default: 300)\r\n   */\r\n  maxSpeed?: number\r\n  /**\r\n   * Enable smooth transitions (default: false)\r\n   */\r\n  transition?: boolean\r\n  /**\r\n   * Speed for pinch zoom (default: 1)\r\n   */\r\n  pinchSpeed?: number\r\n}\r\n\r\n/**\r\n * Represents the current transformation state\r\n */\r\nexport interface Transform {\r\n  /**\r\n   * Current scale value\r\n   */\r\n  scale: number\r\n  /**\r\n   * X offset position\r\n   */\r\n  x: number\r\n  /**\r\n   * Y offset position\r\n   */\r\n  y: number\r\n  /**\r\n   * Rotation angle in degrees\r\n   */\r\n  rotation: number\r\n}\r\n\r\nexport class ImagePanZoom {\r\n  private container: HTMLElement\r\n  private content: HTMLElement\r\n  private options: Required<ImagePanZoomOptions>\r\n\r\n  private scale: number\r\n  private x: number\r\n  private y: number\r\n  private rotation: number\r\n\r\n  private isPanning: boolean = false\r\n  private didMove: boolean = false\r\n  private startClientX: number = 0\r\n  private startClientY: number = 0\r\n  private startX: number = 0\r\n  private startY: number = 0\r\n\r\n  private velocityX: number = 0\r\n  private velocityY: number = 0\r\n  private velocityScale: number = 0\r\n  private lastMoveTime: number = 0\r\n  private lastClientX: number = 0\r\n  private lastClientY: number = 0\r\n  private lastScale: number = 1\r\n  private animationFrameId: number | null = null\r\n\r\n  private readonly DRAG_THRESHOLD = 3\r\n\r\n  private touchStartDistance: number = 0\r\n  private touchStartScale: number = 1\r\n  private touchCenterX: number = 0\r\n  private touchCenterY: number = 0\r\n  private isPinching: boolean = false\r\n  private lastTouchCenterX: number = 0\r\n  private lastTouchCenterY: number = 0\r\n\r\n  private transitionDuration: number = 300\r\n  private transitionEasing: string = 'ease-out'\r\n  private isTransitioning: boolean = false\r\n  private transitionTimeout: number | null = null\r\n\r\n  private lastTouchEndTime: number = 0\r\n  private lastTouchX: number = 0\r\n  private lastTouchY: number = 0\r\n  private readonly DOUBLE_TAP_DELAY: number = 300 // ms\r\n  private readonly DOUBLE_TAP_THRESHOLD: number = 10 // pixels\r\n\r\n  private boundWheel: (e: WheelEvent) => void\r\n  private boundPointerDown: (e: PointerEvent) => void\r\n  private boundPointerMove: (e: PointerEvent) => void\r\n  private boundPointerUp: (e: PointerEvent) => void\r\n  private boundDoubleClick: (e: MouseEvent) => void\r\n  private boundTouchStart: (e: TouchEvent) => void\r\n  private boundTouchMove: (e: TouchEvent) => void\r\n  private boundTouchEnd: (e: TouchEvent) => void\r\n\r\n  constructor(container: HTMLElement, content: HTMLElement, options: ImagePanZoomOptions = {}) {\r\n    this.container = container\r\n    this.content = content\r\n    this.options = {\r\n      minScale: options.minScale ?? 0.5,\r\n      maxScale: options.maxScale ?? 3,\r\n      initialScale: options.initialScale ?? 1,\r\n      wheelZoomSpeed: options.wheelZoomSpeed ?? 0.0015,\r\n      boundsPadding: options.boundsPadding ?? 0.1,\r\n      friction: options.friction ?? 0.92,\r\n      maxSpeed: options.maxSpeed ?? 300,\r\n      transition: options.transition ?? false,\r\n      pinchSpeed: options.pinchSpeed ?? 1,\r\n    }\r\n\r\n    this.scale = this.options.initialScale\r\n    this.x = 0\r\n    this.y = 0\r\n    this.rotation = 0\r\n    this.lastScale = this.options.initialScale\r\n\r\n    this.boundWheel = this.onWheel.bind(this)\r\n    this.boundPointerDown = this.onPointerDown.bind(this)\r\n    this.boundPointerMove = this.onPointerMove.bind(this)\r\n    this.boundPointerUp = this.onPointerUp.bind(this)\r\n    this.boundDoubleClick = this.onDoubleClick.bind(this)\r\n    this.boundTouchStart = this.onTouchStart.bind(this)\r\n    this.boundTouchMove = this.onTouchMove.bind(this)\r\n    this.boundTouchEnd = this.onTouchEnd.bind(this)\r\n\r\n    this.init()\r\n  }\r\n\r\n  /**\r\n   * Initializes the pan and zoom functionality.\r\n   * Sets touch-action and user-select CSS properties on the content element.\r\n   * If transition is enabled, sets the transition CSS property on the content element.\r\n   * Applies the initial transform to the content element.\r\n   * Attaches wheel, pointerdown, pointermove, and pointerup event listeners.\r\n   */\r\n  private init(): void {\r\n    this.content.style.touchAction = 'none'\r\n    this.content.style.userSelect = 'none'\r\n\r\n    this.applyTransform()\r\n    this.attachEvents()\r\n  }\r\n\r\n  private attachEvents(): void {\r\n    this.container.addEventListener('wheel', this.boundWheel, { passive: false })\r\n    this.content.addEventListener('pointerdown', this.boundPointerDown)\r\n    this.content.addEventListener('dblclick', this.boundDoubleClick)\r\n    window.addEventListener('pointermove', this.boundPointerMove)\r\n    window.addEventListener('pointerup', this.boundPointerUp)\r\n\r\n\r\n    this.container.addEventListener('touchstart', this.boundTouchStart, { passive: false })\r\n    this.container.addEventListener('touchmove', this.boundTouchMove, { passive: false })\r\n    this.container.addEventListener('touchend', this.boundTouchEnd, { passive: false })\r\n  }\r\n\r\n  /**\r\n   * Calculate and return the sizes of container and content elements\r\n   * @returns Object containing container width/height, padding, and scaled content dimensions\r\n   */\r\n  private getSizes() {\r\n    const contRect = this.container.getBoundingClientRect()\r\n    const contW = contRect.width\r\n    const contH = contRect.height\r\n    const pad = Math.min(contW, contH) * this.options.boundsPadding\r\n\r\n    const rawW = this.content.offsetWidth\r\n    const rawH = this.content.offsetHeight\r\n    const w = rawW * this.scale\r\n    const h = rawH * this.scale\r\n\r\n    return { contW, contH, pad, w, h }\r\n  }\r\n\r\n  private clampPosition(nextX: number, nextY: number): { x: number; y: number } {\r\n    const { contW, contH, pad, w, h } = this.getSizes()\r\n\r\n    const fitsHorizontally = w <= contW\r\n    const fitsVertically = h <= contH\r\n\r\n    let minX: number, maxX: number, minY: number, maxY: number\r\n    if (fitsHorizontally) {\r\n      minX = maxX = 0\r\n    } else {\r\n      const halfContW = contW / 2\r\n      const halfW = w / 2\r\n\r\n      maxX = halfW - halfContW + pad\r\n      minX = -(halfW - halfContW) - pad\r\n    }\r\n\r\n    if (fitsVertically) {\r\n      minY = maxY = 0\r\n    } else {\r\n      const halfContH = contH / 2\r\n      const halfH = h / 2\r\n\r\n      maxY = halfH - halfContH + pad\r\n      minY = -(halfH - halfContH) - pad\r\n    }\r\n\r\n    const clampedX = fitsHorizontally ? 0 : Math.min(maxX, Math.max(minX, nextX))\r\n    const clampedY = fitsVertically ? 0 : Math.min(maxY, Math.max(minY, nextY))\r\n\r\n    return { x: clampedX, y: clampedY }\r\n  }\r\n\r\n  private applyTransform(useTransition: boolean = false): void {\r\n    this.container.style.overflow = 'hidden'\r\n    if (!this.container.style.position) {\r\n      this.container.style.position = 'relative'\r\n    }\r\n\r\n    this.container.style.minHeight = '25vh'\r\n    this.content.style.position = 'absolute'\r\n    this.content.style.top = '50%'\r\n    this.content.style.left = '50%'\r\n    this.content.style.transformOrigin = '50% 50%'\r\n\r\n    const clamped = this.clampPosition(this.x, this.y)\r\n    this.x = clamped.x\r\n    this.y = clamped.y\r\n\r\n    if (this.options.transition && useTransition && !this.isTransitioning) {\r\n      this.content.style.transition = `transform ${this.transitionDuration}ms ${this.transitionEasing}`\r\n      this.isTransitioning = true\r\n\r\n      if (this.transitionTimeout) {\r\n        clearTimeout(this.transitionTimeout)\r\n      }\r\n      this.transitionTimeout = window.setTimeout(() => {\r\n        this.content.style.transition = ''\r\n        this.isTransitioning = false\r\n        this.transitionTimeout = null\r\n      }, this.transitionDuration)\r\n    } else if (!useTransition) {\r\n      this.content.style.transition = 'none'\r\n      this.isTransitioning = false\r\n    }\r\n\r\n    this.content.style.transform = `translate(-50%, -50%) translate(${this.x}px, ${this.y}px) rotate(${this.rotation}deg) scale(${this.scale})`\r\n  }\r\n\r\n  private clampScale(next: number): number {\r\n    return Math.min(this.options.maxScale, Math.max(this.options.minScale, next))\r\n  }\r\n\r\n  private stopAnimation(): void {\r\n    if (this.animationFrameId !== null) {\r\n      cancelAnimationFrame(this.animationFrameId)\r\n      this.animationFrameId = null\r\n    }\r\n  }\r\n\r\n  private zoomToPoint(clientX: number, clientY: number, deltaScale: number): void {\r\n    const rect = this.container.getBoundingClientRect()\r\n    const prevScale = this.scale\r\n    const nextScale = this.clampScale(prevScale * deltaScale)\r\n\r\n    if (nextScale === prevScale) return\r\n\r\n    const cx = clientX - rect.left\r\n    const cy = clientY - rect.top\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n\r\n    const localX = cx - centerX - this.x\r\n    const localY = cy - centerY - this.y\r\n\r\n    const k = nextScale / prevScale\r\n    const newLocalX = localX * k\r\n    const newLocalY = localY * k\r\n\r\n    this.scale = nextScale\r\n    this.x += localX - newLocalX\r\n    this.y += localY - newLocalY\r\n\r\n    this.applyTransform(false)\r\n  }\r\n\r\n  /**\r\n   * Move the center of the view to the specified coordinates\r\n   * @param targetX - Target X coordinate in container pixels\r\n   * @param targetY - Target Y coordinate in container pixels\r\n   * @param useTransition - Whether to use transition animation (default: true if option is enabled)\r\n   */\r\n  public moveTo(targetX: number, targetY: number, useTransition?: boolean): void {\r\n    this.stopAnimation()\r\n\r\n    const rect = this.container.getBoundingClientRect()\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n\r\n    this.x = targetX - centerX\r\n    this.y = targetY - centerY\r\n\r\n    const clamped = this.clampPosition(this.x, this.y)\r\n    this.x = clamped.x\r\n    this.y = clamped.y\r\n\r\n    const shouldUseTransition = useTransition !== undefined ? useTransition : true\r\n    this.applyTransform(shouldUseTransition && this.options.transition)\r\n  }\r\n\r\n  /**\r\n   * Move by specified delta values\r\n   * @param deltaX - Delta X to move by\r\n   * @param deltaY - Delta Y to move by\r\n   * @param useTransition - Whether to use transition animation (default: true if option is enabled)\r\n   */\r\n  public moveBy(deltaX: number, deltaY: number, useTransition?: boolean): void {\r\n    this.stopAnimation()\r\n\r\n    this.x += deltaX\r\n    this.y += deltaY\r\n\r\n    const clamped = this.clampPosition(this.x, this.y)\r\n    this.x = clamped.x\r\n    this.y = clamped.y\r\n\r\n    const shouldUseTransition = useTransition !== undefined ? useTransition : true\r\n    this.applyTransform(shouldUseTransition && this.options.transition)\r\n  }\r\n\r\n  /**\r\n   * Zoom to specific scale at specified point\r\n   * @param scale - Target scale\r\n   * @param pointX - X coordinate for zoom center (optional, defaults to container center)\r\n   * @param pointY - Y coordinate for zoom center (optional, defaults to container center)\r\n   * @param useTransition - Whether to use transition animation (default: true if option is enabled)\r\n   */\r\n  public zoomTo(scale: number, pointX?: number, pointY?: number, useTransition?: boolean): void {\r\n    this.stopAnimation()\r\n\r\n    const rect = this.container.getBoundingClientRect()\r\n    const targetX = pointX !== undefined ? pointX : rect.width / 2\r\n    const targetY = pointY !== undefined ? pointY : rect.height / 2\r\n\r\n    const prevScale = this.scale\r\n    const nextScale = this.clampScale(scale)\r\n\r\n    if (nextScale === prevScale) return\r\n\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n\r\n    const localX = targetX - centerX - this.x\r\n    const localY = targetY - centerY - this.y\r\n\r\n    const k = nextScale / prevScale\r\n    const newLocalX = localX * k\r\n    const newLocalY = localY * k\r\n\r\n    this.scale = nextScale\r\n    this.x += localX - newLocalX\r\n    this.y += localY - newLocalY\r\n\r\n    const shouldUseTransition = useTransition !== undefined ? useTransition : true\r\n    this.applyTransform(shouldUseTransition && this.options.transition)\r\n  }\r\n\r\n  private animateKinetic = (): void => {\r\n    if (Math.abs(this.velocityX) < 0.5 && Math.abs(this.velocityY) < 0.5 && Math.abs(this.velocityScale) < 0.001) {\r\n      this.stopAnimation()\r\n      this.applyTransform(false)\r\n      return\r\n    }\r\n\r\n    this.x += this.velocityX\r\n    this.y += this.velocityY\r\n    this.scale += this.velocityScale\r\n\r\n    this.scale = this.clampScale(this.scale)\r\n\r\n    this.velocityX *= this.options.friction\r\n    this.velocityY *= this.options.friction\r\n    this.velocityScale *= this.options.friction\r\n\r\n    this.applyTransform(false)\r\n    this.animationFrameId = requestAnimationFrame(this.animateKinetic)\r\n  }\r\n\r\n  private onWheel(e: WheelEvent): void {\r\n    e.preventDefault()\r\n    this.stopAnimation()\r\n    this.velocityX = 0\r\n    this.velocityY = 0\r\n    this.velocityScale = 0\r\n\r\n    const delta = -e.deltaY * this.options.wheelZoomSpeed\r\n    const factor = 1 + delta\r\n    if (factor === 0) return\r\n\r\n    this.zoomToPoint(e.clientX, e.clientY, factor)\r\n  }\r\n\r\n  private onPointerDown(e: PointerEvent): void {\r\n    if (e.button !== 0) return\r\n\r\n    this.stopAnimation()\r\n\r\n    this.isPanning = true\r\n    this.didMove = false\r\n    this.startClientX = e.clientX\r\n    this.startClientY = e.clientY\r\n    this.startX = this.x\r\n    this.startY = this.y\r\n\r\n    this.lastClientX = e.clientX\r\n    this.lastClientY = e.clientY\r\n    this.lastScale = this.scale\r\n    this.lastMoveTime = Date.now()\r\n    this.velocityX = 0\r\n    this.velocityY = 0\r\n    this.velocityScale = 0\r\n\r\n    this.content.setPointerCapture(e.pointerId)\r\n  }\r\n\r\n  private onPointerMove(e: PointerEvent): void {\r\n    if (!this.isPanning) return\r\n\r\n    const dx = e.clientX - this.startClientX\r\n    const dy = e.clientY - this.startClientY\r\n\r\n    if (!this.didMove && Math.hypot(dx, dy) < this.DRAG_THRESHOLD) return\r\n    this.didMove = true\r\n\r\n    const nextX = this.startX + dx\r\n    const nextY = this.startY + dy\r\n\r\n    this.x = nextX\r\n    this.y = nextY\r\n\r\n    const now = Date.now()\r\n    const dt = now - this.lastMoveTime\r\n    if (dt > 0) {\r\n      const vx = (e.clientX - this.lastClientX) / dt * 16\r\n      const vy = (e.clientY - this.lastClientY) / dt * 16\r\n      const scaleDiff = this.scale - this.lastScale\r\n      const scaleVelocity = scaleDiff / dt * 16\r\n\r\n      this.velocityX = Math.max(-this.options.maxSpeed, Math.min(this.options.maxSpeed, vx))\r\n      this.velocityY = Math.max(-this.options.maxSpeed, Math.min(this.options.maxSpeed, vy))\r\n      this.velocityScale = Math.max(-0.01, Math.min(0.01, scaleVelocity))\r\n    }\r\n\r\n    this.lastClientX = e.clientX\r\n    this.lastClientY = e.clientY\r\n    this.lastScale = this.scale\r\n    this.lastMoveTime = now\r\n\r\n    this.applyTransform(false)\r\n  }\r\n\r\n  private onPointerUp(e: PointerEvent): void {\r\n    if (!this.isPanning) return\r\n    this.isPanning = false\r\n\r\n    try {\r\n      this.content.releasePointerCapture(e.pointerId)\r\n    } catch { }\r\n\r\n    if (this.didMove && (Math.abs(this.velocityX) > 1 || Math.abs(this.velocityY) > 1 || Math.abs(this.velocityScale) > 0.001)) {\r\n      this.animationFrameId = requestAnimationFrame(this.animateKinetic)\r\n    }\r\n  }\r\n\r\n  private onDoubleClick(e: MouseEvent): void {\r\n    this.stopAnimation()\r\n    const rect = this.container.getBoundingClientRect()\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n    const clickX = e.clientX - rect.left\r\n    const clickY = e.clientY - rect.top\r\n\r\n    const targetScale = Math.min(this.scale * 1.5, this.options.maxScale)\r\n    const scaleRatio = targetScale / this.scale\r\n\r\n    const localX = clickX - centerX - this.x\r\n    const localY = clickY - centerY - this.y\r\n    this.scale = targetScale\r\n\r\n    const newLocalX = localX * scaleRatio\r\n    const newLocalY = localY * scaleRatio\r\n    this.x += localX - newLocalX\r\n    this.y += localY - newLocalY\r\n\r\n    this.applyTransform(true)\r\n  }\r\n\r\n  private onTouchStart(e: TouchEvent): void {\r\n    if (e.touches.length === 2) {\r\n      e.preventDefault();\r\n      this.stopAnimation();\r\n      this.isPinching = true;\r\n      this.velocityX = 0;\r\n      this.velocityY = 0;\r\n      this.velocityScale = 0;\r\n\r\n      const touch1 = e.touches[0];\r\n      const touch2 = e.touches[1];\r\n\r\n      const dist = Math.hypot(\r\n        touch1.clientX - touch2.clientX,\r\n        touch1.clientY - touch2.clientY\r\n      );\r\n\r\n      this.touchCenterX = (touch1.clientX + touch2.clientX) / 2;\r\n      this.touchCenterY = (touch1.clientY + touch2.clientY) / 2;\r\n      this.lastTouchCenterX = this.touchCenterX;\r\n      this.lastTouchCenterY = this.touchCenterY;\r\n\r\n      this.touchStartDistance = dist;\r\n      this.touchStartScale = this.scale;\r\n\r\n      this.isPanning = false;\r\n      this.didMove = false;\r\n    } else if (e.touches.length === 1) {\r\n      const touch = e.touches[0];\r\n      const syntheticEvent = new PointerEvent('pointerdown', {\r\n        clientX: touch.clientX,\r\n        clientY: touch.clientY,\r\n        button: 0\r\n      });\r\n      this.onPointerDown(syntheticEvent);\r\n    }\r\n  }\r\n\r\n  private onTouchMove(e: TouchEvent): void {\r\n    if (e.touches.length === 2 && this.isPinching) {\r\n      e.preventDefault()\r\n\r\n      const touch1 = e.touches[0]\r\n      const touch2 = e.touches[1]\r\n\r\n      const currentDist = Math.hypot(\r\n        touch1.clientX - touch2.clientX,\r\n        touch1.clientY - touch2.clientY\r\n      )\r\n\r\n      const currentCenterX = (touch1.clientX + touch2.clientX) / 2\r\n      const currentCenterY = (touch1.clientY + touch2.clientY) / 2\r\n\r\n\r\n      const scaleMultiplier = currentDist / this.touchStartDistance\r\n      const newScale = this.touchStartScale * scaleMultiplier * this.options.pinchSpeed\r\n      const clampedScale = this.clampScale(newScale)\r\n\r\n      if (clampedScale !== this.scale) {\r\n\r\n        const deltaX = currentCenterX - this.lastTouchCenterX\r\n        const deltaY = currentCenterY - this.lastTouchCenterY\r\n\r\n        this.x += deltaX\r\n        this.y += deltaY\r\n\r\n        const scaleFactor = clampedScale / this.scale\r\n        this.zoomToPoint(this.touchCenterX, this.touchCenterY, scaleFactor)\r\n\r\n        this.lastTouchCenterX = currentCenterX\r\n        this.lastTouchCenterY = currentCenterY\r\n      }\r\n    } else if (e.touches.length === 1 && !this.isPinching) {\r\n      const touch = e.touches[0]\r\n      const syntheticEvent = new PointerEvent('pointermove', {\r\n        clientX: touch.clientX,\r\n        clientY: touch.clientY\r\n      })\r\n      this.onPointerMove(syntheticEvent)\r\n    }\r\n  }\r\n\r\n  private onTouchEnd(e: TouchEvent): void {\r\n    if (this.isPinching && e.touches.length < 2) {\r\n      this.isPinching = false;\r\n\r\n      const now = Date.now();\r\n      const dt = now - this.lastMoveTime;\r\n      if (dt > 0 && dt < 100) {\r\n        const vx = (this.lastTouchCenterX - this.touchCenterX) / dt * 16;\r\n        const vy = (this.lastTouchCenterY - this.touchCenterY) / dt * 16;\r\n\r\n        this.velocityX = Math.max(-this.options.maxSpeed, Math.min(this.options.maxSpeed, vx));\r\n        this.velocityY = Math.max(-this.options.maxSpeed, Math.min(this.options.maxSpeed, vy));\r\n\r\n        if (Math.abs(this.velocityX) > 1 || Math.abs(this.velocityY) > 1) {\r\n          this.animationFrameId = requestAnimationFrame(this.animateKinetic);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (e.touches.length === 0) {\r\n      if (this.isPanning) {\r\n        const syntheticEvent = new PointerEvent('pointerup', {\r\n          clientX: 0,\r\n          clientY: 0,\r\n          button: 0\r\n        });\r\n        this.onPointerUp(syntheticEvent);\r\n      }\r\n      this.isPinching = false;\r\n\r\n      this.handleDoubleTapCheck(e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle double tap detection for touch devices\r\n   * @param e - Touch event\r\n   */\r\n  private handleDoubleTapCheck(e: TouchEvent): void {\r\n    const now = Date.now();\r\n    const touch = e.changedTouches[0];\r\n\r\n    if (!touch) return;\r\n\r\n    const touchX = touch.clientX;\r\n    const touchY = touch.clientY;\r\n\r\n    // Check if this is a double tap\r\n    if (now - this.lastTouchEndTime < this.DOUBLE_TAP_DELAY &&\r\n      Math.abs(touchX - this.lastTouchX) < this.DOUBLE_TAP_THRESHOLD &&\r\n      Math.abs(touchY - this.lastTouchY) < this.DOUBLE_TAP_THRESHOLD) {\r\n\r\n      // It's a double tap!\r\n      this.handleDoubleTap(touchX, touchY);\r\n\r\n      // Reset to prevent triple tap, etc.\r\n      this.lastTouchEndTime = 0;\r\n      this.lastTouchX = 0;\r\n      this.lastTouchY = 0;\r\n    } else {\r\n      // Store for possible double tap\r\n      this.lastTouchEndTime = now;\r\n      this.lastTouchX = touchX;\r\n      this.lastTouchY = touchY;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle double tap zoom (similar to double click)\r\n   * @param clientX - X coordinate of the tap\r\n   * @param clientY - Y coordinate of the tap\r\n   */\r\n  private handleDoubleTap(clientX: number, clientY: number): void {\r\n    this.stopAnimation();\r\n    const rect = this.container.getBoundingClientRect();\r\n    const centerX = rect.width / 2;\r\n    const centerY = rect.height / 2;\r\n    const clickX = clientX - rect.left;\r\n    const clickY = clientY - rect.top;\r\n\r\n    const targetScale = Math.min(this.scale * 1.5, this.options.maxScale);\r\n    const scaleRatio = targetScale / this.scale;\r\n\r\n    const localX = clickX - centerX - this.x;\r\n    const localY = clickY - centerY - this.y;\r\n    this.scale = targetScale;\r\n\r\n    const newLocalX = localX * scaleRatio;\r\n    const newLocalY = localY * scaleRatio;\r\n    this.x += localX - newLocalX;\r\n    this.y += localY - newLocalY;\r\n\r\n    this.applyTransform(true);\r\n  }\r\n\r\n  /**\r\n   * Reset transform to initial state\r\n   */\r\n  public reset(): void {\r\n    this.stopAnimation()\r\n    this.scale = this.options.initialScale\r\n    this.x = 0\r\n    this.y = 0\r\n    this.rotation = 0\r\n    this.velocityX = 0\r\n    this.velocityY = 0\r\n    this.velocityScale = 0\r\n\r\n    this.applyTransform(true)\r\n  }\r\n\r\n  /**\r\n   * Rotate content by specified degrees\r\n   * @param deg - Degrees to rotate\r\n   */\r\n  public rotate(deg: number): void {\r\n    this.rotation = (this.rotation + deg) % 360\r\n    this.applyTransform(true)\r\n  }\r\n\r\n  /**\r\n   * Get current transform state\r\n   * @returns Current transform object with scale, x, y, and rotation values\r\n   */\r\n  public getTransform(): Transform {\r\n    return {\r\n      scale: this.scale,\r\n      x: this.x,\r\n      y: this.y,\r\n      rotation: this.rotation,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set transform state\r\n   * @param transform - Transform object with scale, x, y, and/or rotation values to set\r\n   */\r\n  public setTransform(transform: Partial<Transform>, useTransition?: boolean): void {\r\n    if (transform.scale !== undefined) {\r\n      this.scale = this.clampScale(transform.scale)\r\n    }\r\n    if (transform.x !== undefined) {\r\n      this.x = transform.x\r\n    }\r\n    if (transform.y !== undefined) {\r\n      this.y = transform.y\r\n    }\r\n    if (transform.rotation !== undefined) {\r\n      this.rotation = transform.rotation\r\n    }\r\n\r\n    const shouldUseTransition = useTransition !== undefined ? useTransition : true\r\n    this.applyTransform(shouldUseTransition && this.options.transition)\r\n  }\r\n\r\n  /**\r\n   * Get the current viewport bounds in container coordinates\r\n   * @returns Object with left, top, right, bottom bounds\r\n   */\r\n  public getViewportBounds(): { left: number; top: number; right: number; bottom: number } {\r\n    const rect = this.container.getBoundingClientRect()\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n\r\n    return {\r\n      left: centerX + this.x,\r\n      top: centerY + this.y,\r\n      right: centerX + this.x,\r\n      bottom: centerY + this.y\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert container coordinates to image coordinates\r\n   * @param containerX - X coordinate in container\r\n   * @param containerY - Y coordinate in container\r\n   * @returns Object with x, y in image coordinates\r\n   */\r\n  public containerToImage(containerX: number, containerY: number): { x: number; y: number } {\r\n    const rect = this.container.getBoundingClientRect()\r\n    const contentRect = this.content.getBoundingClientRect()\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n\r\n    const relativeX = containerX - centerX - this.x\r\n    const relativeY = containerY - centerY - this.y\r\n\r\n    const imageX = (relativeX / this.scale) + (contentRect.width / 2 / this.scale)\r\n    const imageY = (relativeY / this.scale) + (contentRect.height / 2 / this.scale)\r\n\r\n    return { x: imageX, y: imageY }\r\n  }\r\n\r\n  /**\r\n   * Convert image coordinates to container coordinates\r\n   * @param imageX - X coordinate in image\r\n   * @param imageY - Y coordinate in image\r\n   * @returns Object with x, y in container coordinates\r\n   */\r\n  public imageToContainer(imageX: number, imageY: number): { x: number; y: number } {\r\n    const rect = this.container.getBoundingClientRect()\r\n    const contentRect = this.content.getBoundingClientRect()\r\n    const centerX = rect.width / 2\r\n    const centerY = rect.height / 2\r\n\r\n    const relativeX = (imageX - (contentRect.width / 2 / this.scale)) * this.scale\r\n    const relativeY = (imageY - (contentRect.height / 2 / this.scale)) * this.scale\r\n\r\n    const containerX = centerX + this.x + relativeX\r\n    const containerY = centerY + this.y + relativeY\r\n\r\n    return { x: containerX, y: containerY }\r\n  }\r\n\r\n  /**\r\n   * Center on specific image coordinates\r\n   * @param imageX - X coordinate in image\r\n   * @param imageY - Y coordinate in image\r\n   * @param useTransition - Whether to use transition animation (default: true if option is enabled)\r\n   */\r\n  public centerOnImagePoint(imageX: number, imageY: number, useTransition?: boolean): void {\r\n    const containerCoords = this.imageToContainer(imageX, imageY)\r\n    this.moveTo(containerCoords.x, containerCoords.y, useTransition)\r\n  }\r\n\r\n  /**\r\n   * Destroy instance and remove all event listeners\r\n   */\r\n  public destroy(): void {\r\n    this.stopAnimation()\r\n\r\n    if (this.transitionTimeout) {\r\n      clearTimeout(this.transitionTimeout)\r\n      this.transitionTimeout = null\r\n    }\r\n\r\n    this.container.removeEventListener('wheel', this.boundWheel)\r\n    this.content.removeEventListener('pointerdown', this.boundPointerDown)\r\n    this.content.removeEventListener('dblclick', this.boundDoubleClick)\r\n    window.removeEventListener('pointermove', this.boundPointerMove)\r\n    window.removeEventListener('pointerup', this.boundPointerUp)\r\n\r\n    this.container.removeEventListener('touchstart', this.boundTouchStart)\r\n    this.container.removeEventListener('touchmove', this.boundTouchMove)\r\n    this.container.removeEventListener('touchend', this.boundTouchEnd)\r\n\r\n    this.content.style.transform = ''\r\n    this.content.style.touchAction = ''\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Factory function to create a new ImagePanZoom instance\r\n * @param container - Container element to hold the content\r\n * @param content - Content element to apply pan and zoom to\r\n * @param options - Options to configure the behavior\r\n * @returns A new ImagePanZoom instance\r\n */\r\nexport function createImagePanZoom(\r\n  container: HTMLElement,\r\n  content: HTMLElement,\r\n  options?: ImagePanZoomOptions\r\n): ImagePanZoom {\r\n  return new ImagePanZoom(container, content, options)\r\n}"],"names":["ImagePanZoom","container","content","options","scale","x","y","rotation","isPanning","didMove","startClientX","startClientY","startX","startY","velocityX","velocityY","velocityScale","lastMoveTime","lastClientX","lastClientY","lastScale","animationFrameId","DRAG_THRESHOLD","touchStartDistance","touchStartScale","touchCenterX","touchCenterY","isPinching","lastTouchCenterX","lastTouchCenterY","transitionDuration","transitionEasing","isTransitioning","transitionTimeout","lastTouchEndTime","lastTouchX","lastTouchY","DOUBLE_TAP_DELAY","DOUBLE_TAP_THRESHOLD","boundWheel","boundPointerDown","boundPointerMove","boundPointerUp","boundDoubleClick","boundTouchStart","boundTouchMove","boundTouchEnd","constructor","this","minScale","maxScale","initialScale","wheelZoomSpeed","boundsPadding","friction","maxSpeed","transition","pinchSpeed","onWheel","bind","onPointerDown","onPointerMove","onPointerUp","onDoubleClick","onTouchStart","onTouchMove","onTouchEnd","init","style","touchAction","userSelect","applyTransform","attachEvents","addEventListener","passive","window","getSizes","contRect","getBoundingClientRect","contW","width","contH","height","pad","Math","min","rawW","offsetWidth","rawH","offsetHeight","w","h","clampPosition","nextX","nextY","fitsHorizontally","fitsVertically","minX","maxX","minY","maxY","halfContW","halfW","halfContH","halfH","max","useTransition","overflow","position","minHeight","top","left","transformOrigin","clamped","clearTimeout","setTimeout","transform","clampScale","next","stopAnimation","cancelAnimationFrame","zoomToPoint","clientX","clientY","deltaScale","rect","prevScale","nextScale","cx","cy","centerX","centerY","localX","localY","k","newLocalX","newLocalY","moveTo","targetX","targetY","shouldUseTransition","moveBy","deltaX","deltaY","zoomTo","pointX","pointY","animateKinetic","abs","requestAnimationFrame","e","preventDefault","factor","button","Date","now","setPointerCapture","pointerId","dx","dy","hypot","dt","vx","vy","scaleVelocity","releasePointerCapture","clickX","clickY","targetScale","scaleRatio","touches","length","touch1","touch2","dist","touch","syntheticEvent","PointerEvent","currentDist","currentCenterX","currentCenterY","scaleMultiplier","newScale","clampedScale","scaleFactor","handleDoubleTapCheck","changedTouches","touchX","touchY","handleDoubleTap","reset","rotate","deg","getTransform","setTransform","getViewportBounds","right","bottom","containerToImage","containerX","containerY","contentRect","relativeX","relativeY","imageToContainer","imageX","imageY","centerOnImagePoint","containerCoords","destroy","removeEventListener","createImagePanZoom"],"mappings":"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"}